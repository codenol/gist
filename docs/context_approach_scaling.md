# Масштабирование контекстного подхода: проблемы и решения

## Проблема масштабирования

При контекстном подходе компонентные токены ссылаются напрямую на базовый слой (`base.*`), минуя семантический слой. Это создает проблему масштабирования при большом количестве компонентов.

## Практический пример: изменение primary цвета

### Сценарий
Нужно изменить primary цвет с `base.color.blue.500` на `base.color.purple.500` во всех компонентах.

### Без семантического слоя (контекстный подход)

Если у вас 200 компонентов, которые используют `base.color.blue.500` для primary:

```
button_context.json:     base.color.blue.500 → base.color.purple.500
link_context.json:       base.color.blue.500 → base.color.purple.500
icon-button_context.json: base.color.blue.500 → base.color.purple.500
card_context.json:        base.color.blue.500 → base.color.purple.500
... (еще 196 файлов)
```

**Время выполнения:**
- Вручную: 2-5 минут на файл × 200 = **6-16 часов**
- С поиском и заменой: **1-2 часа** (но высокий риск ошибок)
- Со скриптом: **30-60 минут** (но нужно писать и тестировать скрипт)

**Риски:**
- Можно пропустить файлы
- Можно сделать опечатки
- Можно случайно изменить не те значения
- Нужно тестировать каждый компонент

### С семантическим слоем (другие подходы)

Меняем в одном месте:

```json
semantic_functional.color.action.primary = "{base.color.purple.500}"
```

**Время выполнения:** **30 секунд**

**Риски:** Минимальные

## Реальные цифры для разных задач

### 1. Изменение одного значения (primary цвет)

| Подход | Количество файлов | Время (вручную) | Время (скрипт) | Время (LLM/плагин) |
|--------|------------------|-----------------|----------------|---------------------|
| Контекстный (без семантики) | 200 файлов | 6-16 часов | 1-2 часа | **2-5 минут** |
| Функциональный/Роли/Иерархия | 1 файл | 30 секунд | 30 секунд | 30 секунд |

### 2. Ребрендинг (множество изменений)

| Подход | Время (вручную) | Время (LLM/плагин) |
|--------|-----------------|---------------------|
| Контекстный (без семантики) | **Дни работы** | **10-30 минут** |
| С семантическим слоем | **Часы работы** | 5-15 минут |

### 3. White Label решение

| Подход | Сложность (вручную) | Сложность (LLM/плагин) |
|--------|---------------------|------------------------|
| Контекстный (без семантики) | **Практически нереализуемо** | **20-40 минут** на бренд |
| С семантическим слоем | **Просто**: меняем маппинг | 30 секунд на новый бренд |

## Автоматизация через плагин или LLM

### Игра меняется с автоматизацией

Если у вас есть плагин (Figma Tokens, Style Dictionary) или LLM (Claude, ChatGPT, Copilot), который может автоматически изменять токены по всем файлам, расклад сильно меняется.

**С автоматизацией (контекстный подход):**
- Изменение одного значения: **2-5 минут** (промпт для LLM + проверка)
- Ребрендинг: **10-30 минут** (несколько промптов + проверка)
- White Label: **20-40 минут** (автоматическое создание всех вариантов)

**Стоимость автоматизации:**
- Написание промптов: 5-10 минут
- Проверка результата: 5-15 минут
- Тестирование: 10-20 минут
- **Итого: 20-45 минут** вместо 6-16 часов

### Сравнение с семантическим слоем при автоматизации

| Задача | Контекстный + LLM | Семантический слой |
|--------|-------------------|-------------------|
| **Изменение одного значения** | 2-5 минут | 30 секунд |
| **Ребрендинг** | 10-30 минут | 5-15 минут |
| **White Label** | 20-40 минут | 1-2 часа (первый раз) + 30 секунд (новый бренд) |
| **Создание системы с нуля** | 17-33 часа | 59-117 часов |

### Когда автоматизация делает контекстный подход конкурентоспособным

1. **Редкие изменения** (< 10 в год) — время на создание семантического слоя не окупается
2. **Один бренд** — нет необходимости в White Label
3. **Быстрый старт** — можно запуститься за 2-4 дня вместо 7-15
4. **Доступ к LLM** — автоматизация дешевая и доступная

### Новые риски с автоматизацией

**LLM может:**
- Неправильно интерпретировать задачу
- Изменить не те значения
- Пропустить файлы
- Нарушить структуру JSON

**Поэтому нужна проверка:**
- Code review после изменений
- Автоматические тесты
- Визуальная проверка компонентов

**Время на проверку: 10-30 минут**

### Реальный баланс с автоматизацией

Для 200 компонентов с 10 изменениями в год:

**Контекстный + LLM:**
- Создание: 25 часов
- 10 изменений × 15 минут = 2.5 часа
- **Итого за год: 27.5 часа**

**Семантический:**
- Создание: 90 часов
- 10 изменений × 30 секунд = 5 минут
- **Итого за год: 90 часов**

**Разница: 62.5 часа (почти 8 рабочих дней)**

### Когда семантический слой все еще выгоднее

1. **White Label с несколькими брендами** (> 3 брендов) — окупается сразу
2. **Очень частые изменения** (> 50 в год) — семантика быстрее даже с LLM
3. **Большая команда** — единая точка изменений критична
4. **Невозможность использовать LLM** — политики компании, безопасность

## Когда это критично

### 1. White Label решения
Нужно создавать разные версии для разных брендов. Без семантического слоя это означает:
- Дублирование всех 200 файлов компонентных токенов
- Поддержка нескольких версий
- Высокий риск рассинхронизации

### 2. Ребрендинг
Глобальное изменение цветовой палитры. Без семантического слоя:
- Нужно менять в сотнях файлов
- Высокий риск ошибок
- Долгий процесс тестирования

### 3. Тематизация
Светлая/темная тема. Без семантического слоя:
- Нужно создавать отдельные наборы токенов для каждой темы
- Дублирование структуры
- Сложность синхронизации

### 4. A/B тестирование
Быстрая смена цветов для тестирования. Без семантического слоя:
- Невозможно быстро переключаться
- Нужно менять множество файлов

## Компромиссы и рекомендации

### Контекстный подход хорош для:
- ✅ Быстрого прототипирования
- ✅ Небольших проектов (10-20 компонентов)
- ✅ Когда компоненты действительно уникальны и не переиспользуют значения
- ✅ Когда изменения редки и локализованы

### Семантический слой нужен для:
- ✅ Крупных проектов (50+ компонентов)
- ✅ White Label решений
- ✅ Когда нужна единая точка изменений
- ✅ Когда компоненты переиспользуют значения
- ✅ Когда изменения часты и глобальны

## Гибридный подход

Можно использовать комбинацию:
- **Семантический слой** для переиспользуемых значений (цвета, spacing, typography)
- **Контекстный подход** для уникальных компонентных особенностей

Пример:
```json
// Семантический слой
semantic_functional.color.action.primary = "{base.color.blue.500}"

// Компонентные токены
button.primary.background.default = "{semantic_functional.color.action.primary}"
button.unique_feature.special_color = "{base.color.purple.500}" // уникальное для кнопки
```

## Вывод

### Без автоматизации

Для **200 компонентов** без семантического слоя:
- Изменение одного значения: **6-16 часов** (вручную) или **1-2 часа** (скрипт)
- Ребрендинг: **Дни работы**
- White Label: **Практически нереализуемо** без автоматизации

**Рекомендация:** Семантический слой критически важен для больших проектов.

### С автоматизацией (LLM/плагин)

Для **200 компонентов** с автоматизацией:
- Контекстный подход: **27.5 часа за год** (25ч создание + 2.5ч изменения)
- Семантический слой: **90 часов за год** (90ч создание + 5 мин изменения)
- **Экономия: 62.5 часа** в пользу контекстного подхода

**Рекомендация:** 
- Если есть LLM и < 3 брендов — **контекстный подход выгоднее**
- Если нужно White Label (> 3 брендов) — **семантический слой окупается**
- Если изменений > 50 в год — **семантический слой быстрее**

## См. также

- [Документация по контекстному подходу для кнопки](../component_tokens/button/context.md)
- [Документация по контекстному подходу для инпута](../component_tokens/input/context.md)
- [Документация по контекстному подходу для таблицы](../component_tokens/table/context.md)
- [Документация по контекстному подходу для бейджа](../component_tokens/badge/context.md)

